# 需求文档

## 简介

本功能为生物反馈AI伴侣应用添加数据分析能力。系统将记录每次情绪状态采集的数据，在主界面展示每日情绪统计分析，并提供独立的详细数据分析页面，展示趋势图、周报、月报等深度分析，帮助用户全面了解自己的情绪模式。

## 术语表

- **系统 (System)**: 生物反馈AI伴侣应用
- **情绪状态 (Mood State)**: 系统识别的六种情绪类型之一：very_calm（非常平静，20-25）、calm（平静，25-30）、light_tension（轻度紧张，30-35）、tension（紧张，35-40）、excited（兴奋，40-50）、very_excited（极度兴奋，50+)
- **情绪记录 (Mood Record)**: 包含情绪状态、时间戳和原始传感器数值的单条数据记录
- **当日 (Current Day)**: 从00:00:00到23:59:59的24小时时间段
- **本地存储 (Local Storage)**: 浏览器提供的持久化存储机制
- **情绪变化 (Mood Change)**: 系统检测到的情绪状态从一种类型转换为另一种类型的事件
- **GSR传感器值 (GSR Sensor Value)**: 从Arduino GSR传感器读取的原始数值，理论范围0-100，实际常用范围20-50，50以上极为罕见
- **详细分析页面 (Detailed Analytics Page)**: 独立的数据分析界面，展示情绪趋势图、周报、月报等深度分析
- **趋势图 (Trend Chart)**: 显示情绪状态随时间变化的可视化图表
- **周报 (Weekly Report)**: 最近7天的情绪数据统计和分析
- **月报 (Monthly Report)**: 最近30天的情绪数据统计和分析
- **时间范围 (Time Range)**: 用户可选择的数据查看时间段（今日、本周、本月）

## 需求

### 需求 1

**用户故事:** 作为用户，我希望系统自动记录我的情绪数据，以便我可以回顾和分析我的情绪模式。

#### 验收标准

1. WHEN 系统检测到情绪状态发生变化 THEN 系统 SHALL 创建一条新的情绪记录并保存到本地存储
2. WHEN 创建情绪记录 THEN 系统 SHALL 包含情绪状态类型、时间戳和平滑后的传感器数值
3. WHEN 保存情绪记录到本地存储 THEN 系统 SHALL 使用JSON格式进行序列化
4. WHEN 应用启动 THEN 系统 SHALL 从本地存储加载历史情绪记录
5. WHEN 本地存储中不存在历史记录 THEN 系统 SHALL 初始化为空数组并正常运行

### 需求 2

**用户故事:** 作为用户，我希望在主界面看到今天出现次数最多的前三种情绪状态，以便快速了解我今天的整体情绪趋势。

#### 验收标准

1. WHEN 用户查看主界面 THEN 系统 SHALL 显示当日00:00:00到23:59:59时间范围内的情绪统计
2. WHEN 计算情绪统计 THEN 系统 SHALL 统计所有六种情绪状态在当日出现的次数
3. WHEN 显示情绪统计 THEN 系统 SHALL 按出现次数从高到低排序并显示前三名
4. WHEN 某种情绪状态出现次数为零 THEN 系统 SHALL 在统计中排除该情绪状态
5. WHEN 当日没有任何情绪记录 THEN 系统 SHALL 显示友好的空状态提示信息
6. WHEN 当日情绪状态种类少于三种 THEN 系统 SHALL 仅显示实际存在的情绪状态

### 需求 3

**用户故事:** 作为用户，我希望情绪统计界面清晰美观，以便我能轻松理解数据。

#### 验收标准

1. WHEN 显示情绪统计 THEN 系统 SHALL 为每种情绪状态使用对应的颜色主题（绿色系表示平静，黄色系表示紧张，红色系表示兴奋）
2. WHEN 显示情绪统计 THEN 系统 SHALL 显示情绪状态中文名称、出现次数和排名
3. WHEN 显示情绪统计 THEN 系统 SHALL 使用视觉元素（如图标或进度条）增强可读性
4. WHEN 情绪统计组件渲染 THEN 系统 SHALL 与现有界面风格保持一致
5. WHEN 用户在移动设备上查看 THEN 系统 SHALL 确保统计组件响应式布局正常显示
6. WHEN 显示情绪状态名称 THEN 系统 SHALL 使用中文标签（非常平静、平静、轻度紧张、紧张、兴奋、极度兴奋）

### 需求 4

**用户故事:** 作为用户，我希望系统能够高效管理存储空间，以便长期使用不会导致性能问题。

#### 验收标准

1. WHEN 情绪记录数量超过1000条 THEN 系统 SHALL 自动删除最旧的记录
2. WHEN 删除旧记录 THEN 系统 SHALL 保留最近的1000条记录
3. WHEN 执行存储清理 THEN 系统 SHALL 更新本地存储中的数据
4. WHEN 跨日期边界（午夜00:00:00） THEN 系统 SHALL 自动刷新当日统计数据
5. WHEN 用户长时间未使用应用 THEN 系统 SHALL 在重新打开时正确加载和显示最新统计

### 需求 5

**用户故事:** 作为用户，我希望系统能够根据GSR传感器值准确识别六种不同的情绪状态，以便获得更细致的情绪分析。

#### 验收标准

1. WHEN GSR传感器平滑值在20到25之间 THEN 系统 SHALL 识别为"非常平静"状态
2. WHEN GSR传感器平滑值在25到30之间 THEN 系统 SHALL 识别为"平静"状态
3. WHEN GSR传感器平滑值在30到35之间 THEN 系统 SHALL 识别为"轻度紧张"状态
4. WHEN GSR传感器平滑值在35到40之间 THEN 系统 SHALL 识别为"紧张"状态
5. WHEN GSR传感器平滑值在40到50之间 THEN 系统 SHALL 识别为"兴奋"状态
6. WHEN GSR传感器平滑值大于等于50 THEN 系统 SHALL 识别为"极度兴奋"状态
7. WHEN GSR传感器平滑值小于20或等于0 THEN 系统 SHALL 将其视为无效数据或未连接状态并不记录

### 需求 6

**用户故事:** 作为开发者，我希望数据结构清晰且可扩展，以便未来可以添加更多分析功能。

#### 验收标准

1. WHEN 定义情绪记录数据结构 THEN 系统 SHALL 使用TypeScript接口确保类型安全
2. WHEN 设计数据模型 THEN 系统 SHALL 支持未来添加额外字段而不破坏现有数据
3. WHEN 实现数据访问逻辑 THEN 系统 SHALL 将存储操作封装在独立的服务模块中
4. WHEN 处理数据统计 THEN 系统 SHALL 使用纯函数实现计算逻辑以便于测试
5. WHEN 组件需要访问情绪数据 THEN 系统 SHALL 通过自定义React Hook提供数据和操作方法

### 需求 7

**用户故事:** 作为用户，我希望点击主界面的情绪统计后能跳转到详细分析页面，以便查看更深入的情绪数据分析。

#### 验收标准

1. WHEN 用户点击主界面的情绪统计组件 THEN 系统 SHALL 导航到独立的详细分析页面
2. WHEN 导航到详细分析页面 THEN 系统 SHALL 保持应用状态并正确加载历史数据
3. WHEN 详细分析页面加载 THEN 系统 SHALL 显示返回按钮以便用户返回主界面
4. WHEN 用户点击返回按钮 THEN 系统 SHALL 导航回主界面并保持之前的状态
5. WHEN 页面路由变化 THEN 系统 SHALL 更新浏览器URL以支持前进后退导航

### 需求 8

**用户故事:** 作为用户，我希望在详细分析页面看到情绪趋势图，以便直观了解我的情绪随时间的变化模式。

#### 验收标准

1. WHEN 详细分析页面显示趋势图 THEN 系统 SHALL 使用折线图或面积图展示情绪状态随时间的变化
2. WHEN 渲染趋势图 THEN 系统 SHALL 在X轴显示时间，Y轴显示情绪状态或传感器数值
3. WHEN 趋势图包含多个数据点 THEN 系统 SHALL 使用不同颜色区分不同情绪状态
4. WHEN 用户悬停在数据点上 THEN 系统 SHALL 显示该时刻的详细信息（时间、情绪类型、传感器值）
5. WHEN 趋势图数据为空 THEN 系统 SHALL 显示友好的空状态提示
6. WHEN 趋势图在移动设备上显示 THEN 系统 SHALL 确保图表响应式布局并支持触摸交互

### 需求 9

**用户故事:** 作为用户，我希望能够切换查看不同时间范围的数据，以便对比不同时期的情绪状态。

#### 验收标准

1. WHEN 详细分析页面加载 THEN 系统 SHALL 提供时间范围选择器（今日、本周、本月）
2. WHEN 用户选择"今日" THEN 系统 SHALL 显示当日00:00:00到23:59:59的数据
3. WHEN 用户选择"本周" THEN 系统 SHALL 显示最近7天的数据
4. WHEN 用户选择"本月" THEN 系统 SHALL 显示最近30天的数据
5. WHEN 切换时间范围 THEN 系统 SHALL 更新所有图表和统计数据以反映选定范围
6. WHEN 切换时间范围 THEN 系统 SHALL 在500毫秒内完成数据加载和渲染

### 需求 10

**用户故事:** 作为用户，我希望看到周报和月报统计，以便了解较长时间段内的情绪模式。

#### 验收标准

1. WHEN 用户查看周报 THEN 系统 SHALL 显示最近7天每种情绪状态的总出现次数和占比
2. WHEN 用户查看月报 THEN 系统 SHALL 显示最近30天每种情绪状态的总出现次数和占比
3. WHEN 显示周报或月报 THEN 系统 SHALL 使用饼图或柱状图可视化情绪分布
4. WHEN 显示周报或月报 THEN 系统 SHALL 计算并显示平均每日情绪变化次数
5. WHEN 显示周报或月报 THEN 系统 SHALL 标识出现最频繁的情绪状态
6. WHEN 周报或月报数据不足 THEN 系统 SHALL 显示提示信息说明需要更多数据

### 需求 11

**用户故事:** 作为用户，我希望详细分析页面的图表清晰美观且易于理解，以便快速获取有价值的洞察。

#### 验收标准

1. WHEN 显示图表 THEN 系统 SHALL 使用与主界面一致的颜色主题和设计风格
2. WHEN 显示图表 THEN 系统 SHALL 为每种情绪状态使用对应的配置颜色
3. WHEN 显示图表 THEN 系统 SHALL 提供图例说明各颜色代表的情绪状态
4. WHEN 显示图表 THEN 系统 SHALL 使用中文标签和说明文字
5. WHEN 图表数据量较大 THEN 系统 SHALL 自动调整显示密度以保持可读性
6. WHEN 用户在移动设备上查看 THEN 系统 SHALL 确保所有图表和统计信息响应式显示
