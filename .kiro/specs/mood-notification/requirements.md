# 需求文档

## 简介

本功能为生物反馈AI伴侣应用添加情绪关怀通知能力。当系统检测到用户情绪达到"极度兴奋"状态时，将自动推送关心信息，帮助用户及时意识到自己的情绪状态并获得支持。

## 术语表

- **系统 (System)**: 生物反馈AI伴侣应用
- **极度兴奋状态 (Very Excited State)**: GSR传感器平滑值大于等于50的情绪状态
- **关心信息 (Care Message)**: 系统自动生成的温和、支持性的文本消息，旨在帮助用户意识到情绪状态并提供缓解建议
- **推送通知 (Push Notification)**: 在应用界面中显示的即时消息提示
- **情绪状态转换 (Mood State Transition)**: 用户情绪从一种状态变化到另一种状态的事件
- **通知冷却期 (Notification Cooldown)**: 两次通知之间的最小时间间隔，防止频繁打扰用户

## 需求

### 需求 1

**用户故事:** 作为用户，我希望在情绪达到极度兴奋时收到关心提醒，以便我能及时意识到自己的状态并采取行动。

#### 验收标准

1. WHEN 系统检测到情绪状态转换为极度兴奋 THEN 系统 SHALL 立即生成并显示关心信息
2. WHEN 用户已经处于极度兴奋状态 THEN 系统 SHALL 不重复推送通知
3. WHEN 用户从其他状态转换到极度兴奋状态 THEN 系统 SHALL 触发通知
4. WHEN 用户从极度兴奋状态转换到其他状态后再次回到极度兴奋 THEN 系统 SHALL 再次推送通知
5. WHEN 通知被触发 THEN 系统 SHALL 记录通知时间戳

### 需求 2

**用户故事:** 作为用户，我希望关心信息温和且有帮助，以便我感到被支持而不是被打扰。

#### 验收标准

1. WHEN 生成关心信息 THEN 系统 SHALL 使用温和、支持性的语气
2. WHEN 显示关心信息 THEN 系统 SHALL 包含对当前状态的认可
3. WHEN 显示关心信息 THEN 系统 SHALL 提供简单的缓解建议（如深呼吸）
4. WHEN 显示关心信息 THEN 系统 SHALL 使用中文
5. WHEN 显示关心信息 THEN 系统 SHALL 保持简洁（不超过100字）

### 需求 3

**用户故事:** 作为用户，我希望通知不会过于频繁，以便我不会感到被打扰或焦虑。

#### 验收标准

1. WHEN 上次通知时间距今少于5分钟 THEN 系统 SHALL 不发送新的通知
2. WHEN 上次通知时间距今超过5分钟且情绪仍为极度兴奋 THEN 系统 SHALL 允许发送新的通知
3. WHEN 计算通知冷却期 THEN 系统 SHALL 使用准确的时间戳比较
4. WHEN 应用重新启动 THEN 系统 SHALL 重置通知冷却期状态

### 需求 4

**用户故事:** 作为用户，我希望通知以清晰且不侵入的方式显示，以便我能轻松看到但不影响我的其他操作。

#### 验收标准

1. WHEN 通知显示 THEN 系统 SHALL 使用非模态的通知组件
2. WHEN 通知显示 THEN 系统 SHALL 在界面顶部或显著位置展示
3. WHEN 通知显示 THEN 系统 SHALL 使用与极度兴奋状态相关的视觉样式（红色系）
4. WHEN 通知显示 THEN 系统 SHALL 包含关闭按钮允许用户手动关闭
5. WHEN 通知显示超过10秒 THEN 系统 SHALL 自动淡出并关闭通知
6. WHEN 用户点击关闭按钮 THEN 系统 SHALL 立即关闭通知

### 需求 5

**用户故事:** 作为用户，我希望通知内容有一定的变化，以便不会感到机械和重复。

#### 验收标准

1. WHEN 生成关心信息 THEN 系统 SHALL 从预定义的消息模板中随机选择
2. WHEN 系统包含消息模板 THEN 系统 SHALL 至少提供3种不同的消息变体
3. WHEN 选择消息模板 THEN 系统 SHALL 确保每条消息都包含关心和建议元素
4. WHEN 连续触发通知 THEN 系统 SHALL 尽量避免连续使用相同的消息模板

### 需求 6

**用户故事:** 作为开发者，我希望通知系统易于扩展和维护，以便未来可以添加更多通知类型。

#### 验收标准

1. WHEN 实现通知逻辑 THEN 系统 SHALL 将通知管理封装在独立的Hook中
2. WHEN 定义通知数据结构 THEN 系统 SHALL 使用TypeScript接口确保类型安全
3. WHEN 设计通知系统 THEN 系统 SHALL 支持未来添加其他情绪状态的通知
4. WHEN 实现通知组件 THEN 系统 SHALL 使其可复用于不同类型的通知
5. WHEN 管理通知状态 THEN 系统 SHALL 使用React状态管理最佳实践
