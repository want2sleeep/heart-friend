# 实现计划

- [x] 1. 扩展类型定义


  - 在 `src/types.ts` 中添加通知相关的类型定义
  - 定义 `NotificationType`, `Notification`, `NotificationState` 接口
  - 确保类型定义完整且符合设计文档
  - _需求: 6.2_

- [x] 2. 创建消息模板配置


  - 创建 `src/config/notificationConfig.ts` 文件
  - 定义至少5种关心消息模板
  - 定义通知配置常量（冷却期、自动关闭时间等）
  - 确保每条消息不超过100字且包含中文
  - _需求: 2.4, 2.5, 5.2_

- [ ]* 2.1 编写属性测试：消息长度限制
  - **属性 7: 消息长度限制**
  - **验证需求: 2.5**
  - 验证所有消息模板长度不超过100字符
  - _需求: 2.5_

- [ ]* 2.2 编写属性测试：消息使用中文
  - **属性 6: 消息使用中文**
  - **验证需求: 2.4**
  - 验证所有消息模板包含中文字符
  - _需求: 2.4_

- [ ]* 2.3 编写属性测试：消息包含缓解建议
  - **属性 5: 消息包含缓解建议**
  - **验证需求: 2.3**
  - 验证所有消息包含缓解建议关键词
  - _需求: 2.3_

- [ ]* 2.4 编写属性测试：消息模板包含必要元素
  - **属性 12: 消息模板包含必要元素**
  - **验证需求: 5.3**
  - 验证每个模板包含关心和建议元素
  - _需求: 5.3_

- [x] 3. 实现通知管理Hook


  - 创建 `src/hooks/useMoodNotification.ts` 文件
  - 实现情绪状态转换检测逻辑
  - 实现5分钟冷却期机制
  - 实现消息模板选择算法（避免重复）
  - 实现通知创建和关闭功能
  - 管理通知历史记录（最多5条）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2, 3.3, 3.4, 5.1, 5.4, 6.1, 6.5_

- [ ]* 3.1 编写属性测试：状态转换触发通知
  - **属性 1: 状态转换触发通知**
  - **验证需求: 1.1, 1.3**
  - 生成随机情绪状态序列
  - 验证转换到极度兴奋时创建通知
  - _需求: 1.1, 1.3_

- [ ]* 3.2 编写属性测试：相同状态不重复通知
  - **属性 2: 相同状态不重复通知**
  - **验证需求: 1.2**
  - 验证保持在极度兴奋状态不创建新通知
  - _需求: 1.2_

- [ ]* 3.3 编写属性测试：往返转换重新触发
  - **属性 3: 往返转换重新触发**
  - **验证需求: 1.4**
  - 测试"极度兴奋 → 其他 → 极度兴奋"模式
  - _需求: 1.4_

- [ ]* 3.4 编写属性测试：通知时间戳记录
  - **属性 4: 通知时间戳记录**
  - **验证需求: 1.5**
  - 验证所有通知包含有效时间戳
  - _需求: 1.5_

- [ ]* 3.5 编写属性测试：冷却期阻止通知
  - **属性 8: 冷却期阻止通知**
  - **验证需求: 3.1**
  - 测试5分钟内不创建新通知
  - _需求: 3.1_

- [ ]* 3.6 编写属性测试：冷却期后允许通知
  - **属性 9: 冷却期后允许通知**
  - **验证需求: 3.2**
  - 测试5分钟后允许新通知
  - _需求: 3.2_

- [ ]* 3.7 编写属性测试：时间戳比较准确性
  - **属性 10: 时间戳比较准确性**
  - **验证需求: 3.3**
  - 验证时间差计算准确
  - _需求: 3.3_

- [ ]* 3.8 编写属性测试：消息模板选择有效性
  - **属性 11: 消息模板选择有效性**
  - **验证需求: 5.1**
  - 验证返回的消息在模板列表中
  - _需求: 5.1_

- [ ]* 3.9 编写属性测试：消息模板避免重复
  - **属性 13: 消息模板避免重复**
  - **验证需求: 5.4**
  - 验证连续通知使用不同模板
  - _需求: 5.4_

- [ ]* 3.10 编写单元测试：通知管理Hook
  - 测试状态转换检测
  - 测试冷却期逻辑
  - 测试消息选择算法
  - 测试通知创建和关闭
  - 测试历史记录管理
  - 使用React Testing Library
  - _需求: 1.1, 1.2, 1.3, 1.4, 3.1, 3.2, 5.1, 5.4_

- [x] 4. 创建通知Toast组件


  - 创建 `src/components/NotificationToast.tsx` 文件
  - 实现非模态通知界面
  - 实现淡入淡出动画
  - 添加关闭按钮
  - 实现10秒自动关闭功能
  - 使用红色系视觉样式
  - 添加进度条动画
  - 确保响应式布局
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 6.4_

- [ ]* 4.1 编写单元测试：NotificationToast组件
  - 测试通知显示和隐藏
  - 测试自动关闭功能
  - 测试手动关闭功能
  - 测试样式和动画
  - 测试可访问性（ARIA标签）
  - 使用React Testing Library
  - _需求: 4.3, 4.4, 4.5, 4.6_

- [x] 5. 集成到主应用


  - 在 `src/App.tsx` 中导入 `useMoodNotification`
  - 将Hook连接到 `useMoodProcessor` 的输出
  - 添加 `NotificationToast` 组件到应用顶层
  - 确保通知在所有页面都可见
  - 调整z-index确保通知在最上层
  - _需求: 1.1, 4.2_

- [ ]* 5.1 编写集成测试
  - 测试完整通知流程：情绪变化 → 检测 → 通知 → 显示 → 关闭
  - 测试与现有情绪处理系统的集成
  - 测试多次状态转换的行为
  - _需求: 1.1, 1.4, 3.1, 3.2_

- [x] 6. Checkpoint - 确保所有测试通过


  - 确保所有测试通过，如有问题请询问用户

- [x] 7. 优化和完善



  - 添加键盘支持（ESC键关闭通知）
  - 优化性能（useCallback, useMemo）
  - 验证可访问性（ARIA标签、颜色对比度）
  - 添加代码注释
  - 测试边缘情况（快速状态切换、冷却期边界等）
  - _需求: 6.1, 6.4, 6.5_
