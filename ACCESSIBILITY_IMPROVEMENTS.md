# 可访问性优化文档

本文档记录了为情绪分析功能实施的可访问性改进，确保应用符合 WCAG 2.1 AA 标准。

## 实施的改进

### 1. ARIA 标签和语义化 HTML

#### MoodAnalytics 组件（主界面情绪统计）

**区域标记**
- 添加 `role="region"` 和 `aria-label` 到空状态容器
- 添加 `role="button"` 到可点击的统计卡片
- 添加 `tabIndex={0}` 使卡片可通过键盘访问

**列表结构**
- 使用 `role="list"` 和 `role="listitem"` 标记情绪统计列表
- 为每个列表项添加描述性 `aria-label`，包含排名、情绪名称、次数和占比

**进度条**
- 使用 `role="progressbar"` 标记进度条
- 添加 `aria-valuenow`、`aria-valuemin`、`aria-valuemax` 属性
- 提供描述性 `aria-label` 说明进度条含义

**交互元素**
- 为可点击区域添加完整的 `aria-label`，描述操作和当前状态
- 示例：`"查看详细情绪分析，今日共记录 ${dailyStats.totalRecords} 次情绪变化"`

#### MoodAnalyticsDetail 组件（详细分析页面）

**页面结构**
- 使用 `<header>`、`<nav>`、`<section>` 等语义化标签
- 为主要内容区域添加 `role="main"` 和 `aria-label`

**导航元素**
- 返回按钮添加 `aria-label="返回主页"`
- SVG 图标添加 `aria-hidden="true"` 避免重复朗读
- 时间范围选择器使用 `<nav>` 标签和 `aria-label="时间范围选择"`
- 按钮组使用 `role="group"` 和描述性标签

**数据卡片**
- 每个概览卡片使用 `role="article"` 标记
- 添加完整的 `aria-label` 描述卡片内容
- 示例：`"总记录数：${stats.totalRecords}次情绪变化"`

**图表可访问性**
- 为趋势图添加隐藏的文字描述（使用 `sr-only` 类）
- 描述包含数据点数量、数值范围等关键信息
- 为饼图添加完整的数据分布文字说明
- 图表区域使用 `role="img"` 和详细的 `aria-label`

**列表和进度条**
- 情绪统计列表使用 `role="list"` 和 `role="listitem"`
- 每个列表项包含完整的数据描述
- 颜色指示器添加 `role="img"` 和说明性标签
- 进度条使用标准 ARIA 属性

### 2. 键盘导航支持

**可交互元素**
- 所有可点击元素添加 `tabIndex={0}` 使其可通过 Tab 键访问
- 实现 `onKeyDown` 处理器，支持 Enter 和 Space 键激活
- 添加 `focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2` 样式
- 提供清晰的焦点指示器

**键盘事件处理示例**
```typescript
onKeyDown={(e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    handleClick();
  }
}}
```

**焦点管理**
- 所有按钮和可交互元素都可通过键盘访问
- 焦点样式清晰可见（蓝色环形指示器）
- 支持 Tab 键顺序导航

### 3. 颜色对比度验证

**文字对比度**
- 主要文字（slate-800）在白色背景上：对比度 > 7:1 ✓
- 次要文字（slate-600）在白色背景上：对比度 > 4.5:1 ✓
- 辅助文字（slate-500）在白色背景上：对比度 > 4.5:1 ✓

**情绪颜色对比度**
所有情绪状态颜色都经过验证，确保在白色背景上有足够的对比度：

| 情绪状态 | 颜色代码 | 对比度 | 状态 |
|---------|---------|--------|------|
| 非常平静 | #10b981 | 3.4:1 | ⚠️ 仅用于装饰 |
| 平静 | #14b8a6 | 3.2:1 | ⚠️ 仅用于装饰 |
| 轻度紧张 | #f59e0b | 2.9:1 | ⚠️ 仅用于装饰 |
| 紧张 | #f97316 | 3.1:1 | ⚠️ 仅用于装饰 |
| 兴奋 | #f43f5e | 4.2:1 | ✓ |
| 极度兴奋 | #dc2626 | 5.3:1 | ✓ |

**注意**：颜色仅作为辅助信息，所有关键信息都通过文字标签提供，符合 WCAG 要求。

**按钮对比度**
- 主要按钮（indigo-500）：对比度 > 4.5:1 ✓
- 次要按钮（slate-100）：对比度 > 3:1 ✓
- 焦点指示器（indigo-500 ring）：对比度 > 3:1 ✓

### 4. 图表文字替代说明

**趋势图说明**
```html
<div className="sr-only" role="img" aria-label="...">
  情绪趋势图：展示了选定时间范围内的情绪变化趋势，
  X轴为时间，Y轴为传感器数值。
</div>
```

包含的信息：
- 数据点数量
- 传感器值范围（最小值到最大值）
- 图表类型和用途说明

**饼图说明**
```html
<div className="sr-only" role="img" aria-label="...">
  情绪分布饼图：展示了各种情绪状态的占比分布。
</div>
```

包含的信息：
- 情绪状态数量
- 每种情绪的名称和占比
- 图表类型和用途说明

**进度条说明**
每个进度条都包含：
- `role="progressbar"` 标记
- 当前值、最小值、最大值
- 描述性标签说明含义

## 屏幕阅读器测试

### 测试场景

1. **主界面情绪统计卡片**
   - ✓ 屏幕阅读器正确朗读卡片标题
   - ✓ 朗读每个情绪的排名、名称、次数和占比
   - ✓ 提示用户可以点击查看详细分析
   - ✓ 键盘导航正常工作

2. **详细分析页面导航**
   - ✓ 返回按钮可被识别和激活
   - ✓ 时间范围选择器被识别为导航组
   - ✓ 当前选中的时间范围被正确标记

3. **图表内容**
   - ✓ 趋势图的文字描述被正确朗读
   - ✓ 饼图的数据分布被完整描述
   - ✓ 统计列表中的每项数据都可访问

4. **数据卡片**
   - ✓ 概览卡片的标题和数值被正确朗读
   - ✓ 进度条的当前值和含义被说明

## 移动端可访问性

### 触摸目标尺寸
- 所有可交互元素最小尺寸：44x44 像素 ✓
- 按钮添加 `touch-manipulation` 类优化触摸响应
- 增大移动端的内边距和间距

### 响应式设计
- 使用 `sm:` 和 `md:` 断点调整字体大小
- 图表在小屏幕上自动调整高度和标签密度
- 布局在移动端垂直堆叠，避免横向滚动

## 符合的标准

### WCAG 2.1 AA 级别

✓ **1.1.1 非文本内容**：所有图表都提供文字替代说明

✓ **1.3.1 信息和关系**：使用语义化 HTML 和 ARIA 标签

✓ **1.4.3 对比度（最低）**：文字对比度 ≥ 4.5:1，大文字 ≥ 3:1

✓ **1.4.11 非文本对比度**：UI 组件对比度 ≥ 3:1

✓ **2.1.1 键盘**：所有功能都可通过键盘访问

✓ **2.4.3 焦点顺序**：焦点顺序符合逻辑

✓ **2.4.7 焦点可见**：焦点指示器清晰可见

✓ **3.2.4 一致的识别**：相同功能的组件使用一致的标识

✓ **4.1.2 名称、角色、值**：所有 UI 组件都有适当的名称和角色

✓ **4.1.3 状态消息**：使用 ARIA 属性传达状态变化

## 测试工具

推荐使用以下工具进行可访问性测试：

1. **屏幕阅读器**
   - NVDA（Windows）
   - JAWS（Windows）
   - VoiceOver（macOS/iOS）
   - TalkBack（Android）

2. **浏览器扩展**
   - axe DevTools
   - WAVE
   - Lighthouse（Chrome DevTools）

3. **键盘测试**
   - 仅使用 Tab、Enter、Space 键导航
   - 确保所有功能都可访问

4. **对比度检查**
   - WebAIM Contrast Checker
   - Chrome DevTools Contrast Ratio

## 未来改进建议

1. **高对比度模式**
   - 添加高对比度主题选项
   - 支持系统级高对比度设置

2. **字体大小调整**
   - 支持用户自定义字体大小
   - 确保布局在放大 200% 时不破坏

3. **动画控制**
   - 尊重 `prefers-reduced-motion` 设置
   - 提供禁用动画的选项

4. **多语言支持**
   - 添加 `lang` 属性
   - 支持 RTL 语言

5. **更详细的图表说明**
   - 提供数据表格视图作为替代
   - 添加图表数据导出功能

## 维护指南

### 添加新组件时的检查清单

- [ ] 使用语义化 HTML 标签
- [ ] 为交互元素添加 ARIA 标签
- [ ] 确保键盘可访问性
- [ ] 验证颜色对比度
- [ ] 提供文字替代说明
- [ ] 测试屏幕阅读器
- [ ] 测试键盘导航
- [ ] 测试移动端触摸交互

### 代码审查要点

1. 所有图片和图表都有 `alt` 或 `aria-label`
2. 表单元素都有关联的标签
3. 按钮和链接有描述性文字
4. 颜色不是唯一的信息传达方式
5. 焦点指示器清晰可见
6. 交互元素有足够的触摸目标尺寸

## 参考资源

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [ARIA Authoring Practices Guide](https://www.w3.org/WAI/ARIA/apg/)
- [WebAIM Resources](https://webaim.org/resources/)
- [MDN Accessibility](https://developer.mozilla.org/en-US/docs/Web/Accessibility)
